FROM node:12.11.1-alpine

##########################

ENV LC_ALL=C.UTF-8
ENV LANG=C.UTF-8

WORKDIR /opt/app

RUN apk update \
  && apk upgrade \
  && apk add curl \
  && apk add bash

# needed for sharp
RUN apk add --update --no-cache python gcc g++ make libc6-compat
RUN apk add --update --no-cache \
  --repository http://dl-3.alpinelinux.org/alpine/edge/community \
  --repository http://dl-3.alpinelinux.org/alpine/edge/main vips-dev fftw-dev build-base

# speed up native nodejs builds
ENV JOBS=max
RUN yarn global add babel-cli

COPY package.json .
COPY .babelrc .

COPY src src/
COPY tests tests/


RUN yarn install && yarn cache clean

